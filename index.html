<!DOCTYPE html> 
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>√ìptica Cristal ‚Ä¢ Carga de trabajos</title>

  <meta name="theme-color" content="#111827" />
  <link rel="icon" type="image/png" href="logo.png" />
  <link rel="apple-touch-icon" href="icon-192.png" />

  <!-- Estilos -->
  <link rel="stylesheet" href="css/estilos.css?v=3" />
  <link rel="stylesheet" href="css/print.css?v=1" />

  <!-- Notificaciones -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <!-- Overlay de carga -->
  <div id="spinner" class="spinner no-print" aria-hidden="true" hidden>
    <div class="loader"></div>
    <div class="spinner-text">Cargando‚Ä¶</div>
  </div>

  <div class="wrap">
    <!-- Encabezado -->
    <header class="card">
      <div class="title-row">
        <div class="brand">
          <img src="logo.png" alt="√ìptica Cristal" />
          <div>
            <h1>√ìptica Cristal v02 </h1>
            <p class="muted small">San Miguel ‚Ä¢ Argentina</p>
          </div>
        </div>
        <div class="row" style="grid-template-columns:minmax(200px, 280px);">
          <div>
            <label for="numero_trabajo">N√∫mero de trabajo</label>
            <input id="numero_trabajo" name="numero_trabajo" form="formulario"
                   inputmode="numeric" autocomplete="off" />
          </div>
        </div>
      </div>
    </header>

    <!-- Formulario principal -->
    <form id="formulario" class="grid two" autocomplete="off">
      <input type="hidden" id="pack_url" name="pdf" />

      <!-- Columna izquierda -->
      <section class="card grid" aria-label="Datos del trabajo">
        <div class="row cols-3">
          <div>
            <label for="fecha">Fecha que encarga</label>
            <input id="fecha" name="fecha" placeholder="dd/mm/aa" />
          </div>
          <div>
            <label for="entrega-select" class="small">Modalidad de entrega</label>
            <select id="entrega-select" name="entrega">
              <option value="7" selected>Stock (7 d√≠as)</option>
              <option value="3">Urgente (3 d√≠as)</option>
              <option value="15">Laboratorio (15 d√≠as)</option>
            </select>
          </div>
          <div>
            <label for="fecha_retira">Fecha que retira (estimada)</label>
            <input id="fecha_retira" name="fecha_retira" type="date" />
          </div>
        </div>

        <div class="row cols-3">
          <div>
            <label for="dni">DNI</label>
            <input id="dni" name="dni" inputmode="numeric" />
            <div id="dni-loading" class="inline-loader" hidden>
              <span class="pill">Buscando‚Ä¶</span>
            </div>
          </div>
          <div>
            <label for="nombre">Apellido y nombre</label>
            <input id="nombre" name="nombre" placeholder="Apellido primero" />
          </div>
          <div>
            <label for="telefono">Tel√©fono</label>
            <input id="telefono" name="telefono" autocomplete="tel" placeholder="11 2345 6789" />
          </div>
        </div>

        <div class="row cols-2">
          <div>
            <label for="cristal">Tipo de cristal</label>
            <input id="cristal" name="cristal" placeholder="Monofocal / Bifocal / etc." />
          </div>
          <div>
            <label for="precio_cristal">Precio cristal</label>
            <div class="money"><input id="precio_cristal" name="precio_cristal" inputmode="numeric" /></div>
          </div>
        </div>

        <!-- OBRAS SOCIALES -->
        <div class="row cols-2">
          <div>
            <label for="obra_social">Obra social</label>
            <input id="obra_social" name="obra_social" placeholder="Ej: OSDE, Sancor, IOMA‚Ä¶" />
          </div>
          <div>
            <label for="importe_obra_social">Precio obra social</label>
            <div class="money">
              <input id="importe_obra_social" name="importe_obra_social" inputmode="numeric" />
            </div>
          </div>
        </div>

        <!-- OD -->
        <div class="row cols-4">
          <div>
            <label for="od_esf">OD ESF</label>
            <select id="od_esf" name="od_esf"></select>
          </div>
          <div>
            <label for="od_cil">OD CIL</label>
            <select id="od_cil" name="od_cil"></select>
          </div>
          <div>
            <label for="od_eje">OD EJE (0‚Äì180)</label>
            <input id="od_eje" name="od_eje" inputmode="numeric" placeholder="EJE" />
          </div>
          <div>
            <label for="distancia_focal">Distancia focal</label>
            <select id="distancia_focal" name="distancia_focal">
              <option>Monofocal Lejos</option>
              <option>Monofocal Cerca</option>
              <option>Bifocal</option>
              <option>Multifocal</option>
              <option>Ocupacional</option>
              <option>Monofocal Intermedia</option>
              <option>Sobre LC</option>
            </select>
          </div>
        </div>

        <!-- OI -->
        <div class="row cols-4">
          <div>
            <label for="oi_esf">OI ESF</label>
            <select id="oi_esf" name="oi_esf"></select>
          </div>
          <div>
            <label for="oi_cil">OI CIL</label>
            <select id="oi_cil" name="oi_cil"></select>
          </div>
          <div>
            <label for="oi_eje">OI EJE (0‚Äì180)</label>
            <input id="oi_eje" name="oi_eje" inputmode="numeric" placeholder="EJE" />
          </div>
        </div>

        <div class="row cols-3">
          <div>
            <label for="dr">Dr. (oculista)</label>
            <input id="dr" name="dr" placeholder="Opcional" />
          </div>
          <div>
            <label for="dnp">DNP (OD/OI)</label>
            <input id="dnp" name="dnp" placeholder="12/34" />
          </div>
          <div>
            <label for="add">ADD</label>
            <input id="add" name="add" class="grad grad-add" inputmode="numeric" placeholder="0.00" />
          </div>
        </div>

        <div class="row cols-3">
          <div>
            <label for="otro_concepto">Otro concepto</label>
            <input id="otro_concepto" name="otro_concepto" placeholder="Ej: tratamiento" />
          </div>
          <div>
            <label for="precio_otro">Precio otro</label>
            <div class="money"><input id="precio_otro" name="precio_otro" inputmode="numeric" /></div>
          </div>
        </div>

        <div class="row cols-3">
          <div>
            <label for="vendedor">Vendedor</label>
            <input id="vendedor" name="vendedor" />
          </div>
          <div>
            <label for="forma_pago">Forma de pago</label>
            <input id="forma_pago" name="forma_pago" />
          </div>
        </div>
      </section>

      <!-- Columna derecha -->
      <aside class="grid" aria-label="Armaz√≥n y totales">
        <section class="card grid">
          <div class="row cols-3">
            <div>
              <label for="numero_armazon">N¬∫ armaz√≥n</label>
              <input id="numero_armazon" name="numero_armazon" inputmode="text"
                     autocapitalize="characters" autocorrect="off" spellcheck="false"
                     maxlength="12" placeholder="Ej: 13336" />
              <div id="armazon-loading" class="inline-loader" hidden>
                <span class="pill">Buscando‚Ä¶</span>
              </div>
            </div>
            <div>
              <label for="armazon_detalle">Detalle armaz√≥n</label>
              <input id="armazon_detalle" name="armazon_detalle" placeholder="Marca / Modelo / Color" />
            </div>
            <div>
              <label for="precio_armazon">Precio armaz√≥n</label>
              <div class="money"><input id="precio_armazon" name="precio_armazon" inputmode="numeric" /></div>
            </div>
          </div>

          <div class="row cols-3">
            <div>
              <label for="total">Total</label>
              <div class="money"><input id="total" name="total" inputmode="numeric" readonly /></div>
            </div>
            <div>
              <label for="sena">Se√±a</label>
              <div class="money"><input id="sena" name="sena" inputmode="numeric" /></div>
            </div>
            <div>
              <label for="saldo">Saldo</label>
              <div class="money"><input id="saldo" name="saldo" inputmode="numeric" readonly /></div>
            </div>
          </div>
        </section>

        <!-- Fotos -->
        <section class="card grid no-print">
          <div class="actions">
            <button id="btn-foto"    type="button" class="secondary">üì∑ Foto</button>
            <button id="btn-galeria" type="button" class="secondary">üñºÔ∏è Galer√≠a</button>
          </div>
          <div id="galeria-fotos" class="galeria"></div>
        </section>

        <!-- Acciones -->
        <section class="card grid no-print">
          <div class="actions">
            <button id="btn-imprimir" type="button" class="ghost">Imprimir</button>
            <button id="btn-limpiar"  type="button" class="secondary">Limpiar</button>
            <button id="btn-mini-2up" class="no-print">Orden VIRTUAL</button>
            <button type="submit">Guardar</button>
          </div>
        </section>
      </aside>

      <!-- Historial -->
      <section class="card" id="hist-card" style="grid-column:1 / -1; margin-top:12px;">
        <h3 style="margin:0 0 8px 0; font-size:16px;">Historial</h3>
        <div class="row cols-3">
          <input id="hist-q" placeholder="Buscar: nombre, DNI, tel o @123 (exacto)" />
          <input id="hist-limit" type="number" min="1" max="500" value="100" />
          <button id="hist-buscar" type="button">Buscar</button>
        </div>
        <div id="historial" class="small muted" style="margin-top:8px;"></div>
      </section>
    </form>
  </div>

  <!-- Modal de c√°mara -->
  <div id="cam-modal" class="cam-modal" hidden>
    <div class="cam-dialog">
      <div class="cam-head">
        <span>C√°mara</span>
        <button id="cam-close-x" class="cam-close" type="button">Cerrar</button>
      </div>
      <div class="cam-body">
        <video id="cam-video" playsinline></video>
        <div id="cam-preview"><canvas id="cam-shot"></canvas></div>
      </div>
      <div class="cam-actions">
        <button id="cam-tomar"   type="button">Tomar foto</button>
        <button id="cam-usar"    type="button" disabled>Usar esta</button>
        <button id="cam-cancelar" type="button">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Contenedor exclusivo para impresi√≥n -->
  <div id="print-root" class="avoid-break" aria-hidden="true">
    <div id="print-stack">
      <section id="print-panel" class="avoid-break">
        <div id="panel-top">
          <img id="print-logo" src="logo.png" alt="√ìptica Cristal" />
          <img id="print-barcode" alt="C√≥digo" />
        </div>

        <div class="print-row"><div class="print-label">N¬∞ Trabajo</div><div class="print-value" id="pv-numero"></div></div>
        <div class="print-row"><div class="print-label">Cliente</div><div class="print-value" id="pv-cliente"></div></div>
        <div class="print-row"><div class="print-label">DNI</div><div class="print-value" id="pv-dni"></div></div>
        <div class="print-row"><div class="print-label">Tel√©fono</div><div class="print-value" id="pv-tel"></div></div>
        <div class="print-row"><div class="print-label">Fecha</div><div class="print-value" id="pv-fecha"></div></div>
        <div class="print-row"><div class="print-label">Retira</div><div class="print-value" id="pv-retira"></div></div>

        <div id="panel-receta" class="avoid-break">
          <div class="rec-box">
            <h4>Graduaci√≥n OD</h4>
            <div class="rec-grid">
              <div class="rec-label">ESF</div><div id="pv-od-esf"></div>
              <div class="rec-label">CIL</div><div id="pv-od-cil"></div>
              <div class="rec-label">EJE</div><div id="pv-od-eje"></div>
            </div>
          </div>
          <div class="rec-box">
            <h4>Graduaci√≥n OI</h4>
            <div class="rec-grid">
              <div class="rec-label">ESF</div><div id="pv-oi-esf"></div>
              <div class="rec-label">CIL</div><div id="pv-oi-cil"></div>
              <div class="rec-label">EJE</div><div id="pv-oi-eje"></div>
            </div>
          </div>
          <div class="rec-box">
            <h4>Detalles</h4>
            <div class="rec-grid">
              <div class="rec-label">Cristal</div><div id="pv-cristal"></div>
              <div class="rec-label">Armaz√≥n</div><div id="pv-armazon"></div>
              <div class="rec-label">Entrega</div><div id="pv-entrega"></div>
              <div class="rec-label">DNP</div><div id="pv-dnp"></div>
              <div class="rec-label">ADD</div><div id="pv-add"></div>
              <div class="rec-label">DR</div><div id="pv-dr"></div>
            </div>
          </div>
          <img id="panel-foto" alt="Foto" />
        </div>

        <div id="panel-totales">
          <div>
            <div><strong>Se√±a:</strong> <span id="pv-sena"></span></div>
            <div><strong>Saldo:</strong> <span id="pv-saldo"></span></div>
          </div>
          <div class="total-fig">TOTAL: <span id="pv-total"></span></div>
        </div>
      </section>

      <div class="print-cutline"></div>

      <section id="print-coupon" class="avoid-break">
        <div id="coupon-head">
          <div><strong>√ìptica Cristal</strong><br/><span id="cpn-numero"></span></div>
          <img id="coupon-barcode" alt="C√≥digo" />
        </div>
        <div class="coupon-row"><div class="coupon-label">Cliente</div><div id="cpn-cliente"></div></div>
        <div class="coupon-row"><div class="coupon-label">Retira</div><div id="cpn-retira"></div></div>
        <div class="coupon-row"><div class="coupon-label">Tel√©fono</div><div id="cpn-tel"></div></div>
        <div class="coupon-row"><div class="coupon-label">Total</div><div id="cpn-total"></div></div>
      </section>
    </div>
  </div>

  <!-- JS -->
  <script type="module" src="./js/main.js?v=13"></script>
</body>
</html>
